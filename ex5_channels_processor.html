<!DOCTYPE html>
<html>
    <head>Channels</head>
    <body>
        <h1>WebAudio Channels</h1>
        <script type="text/javascript">
            
            var context;
            var speaker;
            var lineIn;
            var processor;
            var mute;
            var audioBuffer;

            var LEFT_CHANNEL = 0;
            var RIGHT_CHANNEL = 1;
            var CHANNELS = 2;
            var BUFFER_SIZE = 4096;

            function initAudio() {
                if (!navigator.getUserMedia)
    	            navigator.getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                
                context = new AudioContext();
                speakers = context.destination;

                if (navigator.getUserMedia) {
                    captureLineIn();
                }
            }

            function captureLineIn() {
                audioBuffer = context.createBuffer(CHANNELS, BUFFER_SIZE, context.sampleRate);                
                processor = context.createScriptProcessor(BUFFER_SIZE, CHANNELS, CHANNELS);

                navigator.getUserMedia({audio: true}, getStream, userMediaError);
                processor.addEventListener('audioprocess', processAudio);
            }

            function getStream(stream) {
                //Get Stream from lineIn 
                lineIn = context.createMediaStreamSource(stream);
                //Send the stream to processor
                lineIn.connect(processor);
                //Connect processor to speakers
                processor.connect(speakers);
            }

            function processAudio (ev) {
                processBuffer(ev.inputBuffer.getChannelData(LEFT_CHANNEL));
            }

            function processBuffer(buffer) {
                //Put lineIn left channel into audioBuffer left channel
                audioBuffer.getChannelData(LEFT_CHANNEL).set(buffer);
                //Create a sourceBuffer so we can connect it to the speaker
                var source = context.createBufferSource();
                source.buffer = audioBuffer;
                source.start();
                source.connect(speakers);
                
            }

            function userMediaError(err) {
                console.error(err);
            }

            window.onload  = initAudio();
        </script>
    </body>
</html>